<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Блог | MARKETING PRO</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Outfit:wght@700;900&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/@sanity/client@3.2.0/umd/sanityClient.min.js"></script>
    <link rel="stylesheet" href="../styles.css">
</head>

<body>

    <nav>
        <div class="container">
            <a href="../index.html" class="logo">MARKETING<span>PRO</span></a>
            <ul class="nav-links">
                <li><a href="../index.html#hero">Главная</a></li>
                <li><a href="../index.html#programs">Программы</a></li>
                <li><a href="index.html">Блог</a></li>
                <li><a href="../index.html#free">Ресурсы</a></li>
            </ul>
        </div>
    </nav>

    <header class="blog-hero">
        <div class="container">
            <h1>Блог</h1>
            <p>Инсайты, стратегии и новости маркетинга</p>
        </div>
    </header>

    <main class="blog-content">
        <div class="container">
            <div id="loader">Загрузка постов...</div>
            <div id="blog-grid" class="blog-grid"></div>
        </div>
    </main>

    <script>
        const client = SanityClient({
            projectId: 'p0rtrgcn',
            dataset: 'production',
            useCdn: true,
            apiVersion: '2021-10-21'
        });

        async function fetchPosts() {
            try {
                const query = `*[_type == "post"] | order(publishedAt desc) {
                    title,
                    "slug": slug.current,
                    excerpt,
                    "imageUrl": featuredImage.asset->url,
                    author,
                    publishedAt,
                    category
                }`;

                const posts = await client.fetch(query);
                displayPosts(posts);
            } catch (err) {
                console.error(err);
                document.getElementById('loader').innerText = 'Ошибка при загрузке постов.';
            }
        }

        function displayPosts(posts) {
            const grid = document.getElementById('blog-grid');
            const loader = document.getElementById('loader');

            loader.style.display = 'none';

            if (posts.length === 0) {
                loader.style.display = 'block';
                loader.innerText = 'Пока нет опубликованных постов.';
                return;
            }

            grid.innerHTML = posts.map(post => `
                <a href="post.html?slug=${post.slug}" class="blog-card">
                    <img src="${post.imageUrl || 'https://via.placeholder.com/400x220'}" alt="${post.title}" class="card-image">
                    <div class="card-body">
                        ${post.category ? `<div class="card-category">${post.category}</div>` : ''}
                        <h2 class="card-title">${post.title}</h2>
                        <p class="card-excerpt">${post.excerpt || ''}</p>
                        <div class="card-footer">
                            <span class="card-author">${post.author || 'Команда PRO'}</span>
                            <span>${new Date(post.publishedAt).toLocaleDateString('ru-RU')}</span>
                        </div>
                    </div>
                </a>
            `).join('');
        }

        fetchPosts();
    </script>
</body>

</html>